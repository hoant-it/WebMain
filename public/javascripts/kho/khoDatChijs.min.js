let maHang="",mauMH="",soLuong=0,chuyen="",order="";const datChiCaptionTotal="Total",datChiCaptionCT="Details",topRowCell=10,searchBoxMaHang=()=>{const e=DevExpress.data.AspNet.createStore({key:"MAHANG",loadMode:"raw",loadUrl:"wacoal_MaHang_Select_V1"});$("#searchBoxMH").dxSelectBox({dataSource:e,displayExpr:"MAHANG",valueExpr:"MAHANG",searchEnabled:!0,searchExpr:"MAHANG",searchMode:"contains",searchTimeout:200,minSearchLength:0,showDataBeforeSearch:!1,showClearButton:!0,placeholder:"Mã Hàng",onValueChanged:function(e){null!==e.value?(maHang=e.value,console.log(maHang),searchBoxMau()):console.log("Not selected")}}).dxSelectBox("instance")},searchBoxMau=()=>{const e=DevExpress.data.AspNet.createStore({key:"MAUMH",loadMode:"raw",loadUrl:`wacoal_Datchi_MauMH_Load_Web_V1/${maHang}`});$("#searchBoxMauMH").dxSelectBox({dataSource:e,displayExpr:"MAUMH",valueExpr:"MAUMH",searchEnabled:!0,searchExpr:"MAUMH",searchMode:"contains",searchTimeout:200,minSearchLength:0,showDataBeforeSearch:!1,showClearButton:!0,placeholder:"Màu Mã Hàng...",onValueChanged:function(e){null!==e.value?mauMH=e.value:console.log("Not selected")}}).dxSelectBox("instance")},searchBoxLine=()=>{const e=DevExpress.data.AspNet.createStore({key:"MACHUYEN",loadMode:"raw",loadUrl:"wacoal_CHUYEN_Load_Web_V1"});$("#searchBoxLine").dxSelectBox({dataSource:e,displayExpr:"MACHUYEN",valueExpr:"MACHUYEN",searchEnabled:!0,searchExpr:"MACHUYEN",searchMode:"contains",searchTimeout:200,minSearchLength:0,showDataBeforeSearch:!1,showClearButton:!0,placeholder:"Chuyền...",onValueChanged:function(e){null!==e.value?chuyen=e.value:console.log("Not selected")}}).dxSelectBox("instance")},DatChiLoad=()=>{soLuong=$("#txtSL").dxNumberBox("instance").option("value"),""!==order?""!==chuyen?""!==maHang?""!==mauMH?0!==soLuong&&null!==soLuong?(tabPanelLoad(),btnExportMultiExcel()):alert("Chưa nhập số lượng"):alert("Chưa nhập màu Mã Hàng"):alert("Chưa nhập Mã Hàng"):alert("Chưa nhập Chuyền"):alert("Chưa nhập Order")},tabPanelLoad=()=>{var e="wacoal_DatChi_MH_Mau_SL_Web_V1/",t=DevExpress.data.AspNet.createStore({key:"STT",loadUrl:e+maHang+"/"+mauMH+"/"+soLuong,onBeforeSend:function(e,t){t.xhrFields={withCredentials:!0}}}),a="wacoal_TinhChi_MaHang_Mau_SL_V2/",n=DevExpress.data.AspNet.createStore({key:"keyMAHANG",loadUrl:a+maHang+"/"+mauMH+"/"+soLuong,onBeforeSend:function(e,t){t.xhrFields={withCredentials:!0}}});$("#tabPanel").dxTabPanel({dataSource:[{title:datChiCaptionTotal,template:()=>$("<div id='GridDatChiTotal'>").dxDataGrid({width:"100%",columns:[{caption:"MÃ HÀNG",alignment:"left",dataField:"MAHANG"},{caption:"MÀU MH",alignment:"left",dataField:"MAUMH"},{caption:"SL Đánh",alignment:"left",dataField:"Qty"},{caption:"R60",alignment:"center",columns:[{caption:"COLOR",alignment:"left",dataField:"COLOR_R60",format:"string"},{caption:"QTY",alignment:"right",dataField:"SL_R60",format:{precision:1}},{caption:"TOTAL",alignment:"right",dataField:"SLFN_R60",format:{precision:1}}]},{caption:"WA",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_WA"},{caption:"QTY",alignment:"center",dataField:"SL_WA"},{caption:"TOTAL",alignment:"right",dataField:"SLFN_WA",format:{precision:1}}]},{caption:"WB",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_WB"},{caption:"QTY",alignment:"center",dataField:"SL_WB"},{caption:"TOTAL",alignment:"right",dataField:"SLFN_WB",format:{precision:1}}]},{caption:"W300",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_W300"},{caption:"QTY",alignment:"center",dataField:"SL_W300"},{caption:"TOTAL",alignment:"right",dataField:"SLFN_W300",format:{precision:1}}]},{caption:"KS60",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_KS60"},{caption:"QTY",alignment:"center",dataField:"SL_KS60"},{caption:"TOTAL",alignment:"right",dataField:"SLFN_KS60",format:{precision:1}}]},{caption:"UN420",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_UN420"},{caption:"QTY",alignment:"center",dataField:"SL_UN420"},{caption:"TOTAL",alignment:"right",dataField:"SLFN_UN420",format:{precision:1}}]},{caption:"UN280",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_UN280"},{caption:"QTY",alignment:"center",dataField:"SL_UN280"},{caption:"TOTAL",alignment:"right",dataField:"SLFN_UN280",format:{precision:1}}]},{caption:"R50",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_R50"},{caption:"QTY",alignment:"center",dataField:"SL_R50"},{caption:"TOTAL",alignment:"right",dataField:"SLFN_R50",format:{precision:1}}]},{caption:"S80",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_S80"},{caption:"QTY",alignment:"center",dataField:"SL_S80"},{caption:"TOTAL",alignment:"right",dataField:"SLFN_S80",format:{precision:1}}]}],summary:{totalItems:[{column:"COLOR_R60",summaryType:"count",customizeText:function(e){return"Total"}},{column:"SLFN_R60",summaryType:"sum",valueFormat:"Decimal",customizeText:function(e){return e.value}},{column:"SLFN_WA",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SLFN_WB",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SLFN_W300",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SLFN_KS60",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SLFN_UN420",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SLFN_UN280",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SLFN_K80",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SLFN_R50",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SLFN_S80",summaryType:"sum",customizeText:function(e){return e.value}}]},showBorders:!0,rowAlternationEnabled:!0,dataSource:n})},{title:datChiCaptionCT,template:()=>$("<div id='GridDatChiCT'>").dxDataGrid({width:"100%",columns:[{caption:"Tên Công Đoạn",alignment:"left",dataField:"TENCONGDOAN"},{caption:"Ký Hiệu Máy",alignment:"left",dataField:"KYHIEUMAY",format:"string",width:100},{caption:"Mã Vị Trí",alignment:"left",dataField:"MAVITRICHI",width:100},{caption:"Loại Máy",alignment:"left",dataField:"LOAIMAY",width:150},{caption:"SL/PCS (Mét) (1)",alignment:"right",dataField:"MET_PSC",width:77},{caption:"SL Đánh (2)",alignment:"right",dataField:"Qty",width:77},{caption:"Công Đoạn",alignment:"right",dataField:"CONGDOAN",width:100},{caption:"Loại Chỉ",alignment:"left",dataField:"LOAICHI",width:77},{caption:"Màu Chỉ",alignment:"left",dataField:"MauChi",width:77},{caption:"SL Chỉ(Mét) (1*2)",alignment:"right",dataField:"SLChi",width:150,dataType:"number"}],showBorders:!0,rowAlternationEnabled:!0,dataSource:t,columnsAutoWidth:!0,height:450,allowColumnReordering:!0,rowAlternationEnabled:!0,showColumnLines:!0,showRowLines:!0,showBorders:!0,focusedRowEnabled:!0,wordWrapEnabled:!0,scrolling:{mode:"virtual"}})}],itemTitleTemplate(e,t,a){a.append(`<span class='dx-tab-text'>${e.title}</span>`)},deferRendering:!1})},formatHeaderRow=e=>{for(let t=1;t<topRowCell-1;t++)e.getRow(t).getCell(1).font={bold:!0,size:14},e.getRow(t).getCell(2).font={bold:!0,size:14}},btnExportMultiExcel=()=>{const e=new generals;$("#exportButton").dxButton({text:"",icon:"xlsxfile",onClick(){function t(e,t){"header"!==e.rowType&&"data"!==e.rowType||(t.fullAddress.row%2==0&&(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"D3D3D3"},bgColor:{argb:"D3D3D3"}}),t.font={size:"14",name:"EUDC"},t.border={top:{style:"thin",color:{argb:"00000000"}},left:{style:"thin",color:{argb:"00000000"}},bottom:{style:"thin",color:{argb:"00000000"}},right:{style:"thin",color:{argb:"00000000"}}})}function a(e,t){"header"===e.rowType&&(t.fill={type:"pattern",pattern:"solid",fgColor:{argb:"D3D3D3"},bgColor:{argb:"D3D3D3"}})}const n=$("#GridDatChiTotal").dxDataGrid("instance"),o=$("#GridDatChiCT").dxDataGrid("instance"),l=new ExcelJS.Workbook,i=l.addWorksheet(datChiCaptionTotal),r=l.addWorksheet(datChiCaptionCT);i.getRow(1).getCell(1).value="Đánh chỉ Tổng",i.getRow(1).getCell(1).font={bold:!0,size:16,underline:"double"},i.getRow(3).getCell(1).value="Order",i.getRow(3).getCell(2).value=order,i.getRow(4).getCell(1).value="Chuyền",i.getRow(4).getCell(2).value=chuyen,i.getRow(5).getCell(1).value="Mã Hàng",i.getRow(5).getCell(2).value=maHang,i.getRow(6).getCell(1).value="Màu",i.getRow(6).getCell(2).value=mauMH,i.getRow(7).getCell(1).value="Số Lượng",i.getRow(7).getCell(2).value=soLuong,i.getRow(8).getCell(1).value="Thời Gian",i.getRow(8).getCell(2).value=e.getDateTime(),formatHeaderRow(i),r.getRow(1).getCell(1).value="Đánh chỉ Chi Tiết",r.getRow(1).getCell(1).font={bold:!0,size:16,underline:"double"},r.getRow(3).getCell(1).value="Order",r.getRow(3).getCell(2).value=order,r.getRow(4).getCell(1).value="Chuyền",r.getRow(4).getCell(2).value=chuyen,r.getRow(5).getCell(1).value="Mã Hàng",r.getRow(5).getCell(2).value=maHang,r.getRow(6).getCell(1).value="Màu",r.getRow(6).getCell(2).value=mauMH,r.getRow(7).getCell(1).value="Số Lượng",r.getRow(7).getCell(2).value=soLuong,r.getRow(8).getCell(1).value="Thời Gian",r.getRow(8).getCell(2).value=e.getDateTime(),formatHeaderRow(r),DevExpress.excelExporter.exportDataGrid({worksheet:i,component:n,topLeftCell:{row:topRowCell,column:1},customizeCell(e){a(e.gridCell,e.excelCell)}}).then(()=>DevExpress.excelExporter.exportDataGrid({worksheet:r,component:o,topLeftCell:{row:topRowCell,column:1},customizeCell(e){var a=e;a.font={name:"EUDC",size:12},a.alignment={horizontal:"left"},t(a.gridCell,a.excelCell)}})).then(()=>{l.xlsx.writeBuffer().then(t=>{saveAs(new Blob([t],{type:"application/octet-stream"}),`DanhChi_${order}_${chuyen}_${maHang}_${mauMH}_${soLuong}_${e.getDateTime()}.xlsx`)})})}})},searchBoxOrder=()=>{const e=DevExpress.data.AspNet.createStore({key:"ORDERNO",loadMode:"raw",loadUrl:"wacoal_DONHANGHEAD_Load_Web_V1"});$("#searchBoxOrder").dxSelectBox({dataSource:e,displayExpr:"ORDERNO",valueExpr:"ORDERNO",searchEnabled:!0,searchExpr:"ORDERNO",searchMode:"contains",searchTimeout:200,minSearchLength:0,showDataBeforeSearch:!1,showClearButton:!0,placeholder:"Order...",onValueChanged:function(e){null!==e.value?order=e.value:console.log("Not selected")}}).dxSelectBox("instance")};$(()=>{searchBoxMaHang(),searchBoxMau(),searchBoxLine(),searchBoxOrder(),$("#txtSL").dxNumberBox({value:null,placeholder:"Nhập Số Lượng",showClearButton:!0}),$("#btn-datChi").dxButton({stylingMode:"contained",text:"Đánh Chỉ",type:"default",width:120,onClick(){DatChiLoad()}})});