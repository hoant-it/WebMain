var MaHang="";const searchBoxMaHang=()=>{const e=DevExpress.data.AspNet.createStore({key:"MAHANG",loadMode:"raw",loadUrl:"wacoal_MaHang_Select_V1"});$("#searchBoxMH").dxSelectBox({dataSource:e,displayExpr:"MAHANG",valueExpr:"MAHANG",searchEnabled:!0,searchExpr:"MAHANG",searchMode:"contains",searchTimeout:200,minSearchLength:0,showDataBeforeSearch:!1}).dxSelectBox("instance")},GridviewMaHangLoad=e=>{var n="wacoal_TinhChi_MaHang_V3/",a=DevExpress.data.AspNet.createStore({key:"keyMAHANG",loadUrl:n+e,onBeforeSend:function(e,n){n.xhrFields={withCredentials:!0}}});$("#GridTinhChi").dxDataGrid({dataSource:a,columnsAutoWidth:!0,height:555,allowColumnReordering:!0,rowAlternationEnabled:!0,showColumnLines:!0,showRowLines:!0,showBorders:!0,export:{enabled:!0},onExporting:function(n){var a=new ExcelJS.Workbook,t=a.addWorksheet("FORMAT ĐẶT CHỈ");DevExpress.excelExporter.exportDataGrid({component:n.component,worksheet:t,customizeCell:function(e){var n=e.gridCell,a=e.excelCell;"data"===n.rowType&&(n.column.dataField.includes("COLOR")&&(a.alignment={horizontal:"left"}),n.column.dataField.includes("SL")&&(0===n.value&&(a.numFmt="-"),a.alignment={horizontal:"right"})),"totalFooter"===n.rowType&&(a.alignment={horizontal:"right"})}}).then(function(){a.xlsx.writeBuffer().then(function(n){var a="";a="*"===e?"All":e,saveAs(new Blob([n],{type:"application/octet-stream"}),"TinhChi_MH_"+a+".xlsx")})}),n.cancel=!0},focusedRowEnabled:!0,scrolling:{mode:"virtual"},columns:[{caption:"MÃ HÀNG",alignment:"left",dataField:"MAHANG"},{caption:"MÀU MH",alignment:"left",dataField:"MAUMH"},{caption:"R60",alignment:"center",columns:[{caption:"COLOR",alignment:"left",dataField:"COLOR_R60",format:"string"},{caption:"QTY",alignment:"right",dataField:"SL_R60",format:{precision:1}}]},{caption:"WA",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_WA"},{caption:"QTY",alignment:"center",dataField:"SL_WA"}]},{caption:"WB",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_WB"},{caption:"QTY",alignment:"center",dataField:"SL_WB"}]},{caption:"W300",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_W300"},{caption:"QTY",alignment:"center",dataField:"SL_W300"}]},{caption:"KS60",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_KS60"},{caption:"QTY",alignment:"center",dataField:"SL_KS60"}]},{caption:"UN420",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_UN420"},{caption:"QTY",alignment:"center",dataField:"SL_UN420"}]},{caption:"UN280",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_UN280"},{caption:"QTY",alignment:"center",dataField:"SL_UN280"}]},{caption:"R50",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_R50"},{caption:"QTY",alignment:"center",dataField:"SL_R50"}]},{caption:"S80",alignment:"center",columns:[{caption:"COLOR",alignment:"center",dataField:"COLOR_S80"},{caption:"QTY",alignment:"center",dataField:"SL_S80"}]}],onToolbarPreparing:function(n){n.toolbarOptions.items.unshift({location:"alter",template:function(){return $("<div/>").addClass("informer").append('\n                         <form action="/kho/congodanmahanginputv2" method="POST" enctype="multipart/form-data" id="frmUpload">\n                         <input type="file" name="filename" id="filename" />\n                         </from>\n                         ')}},{location:"alter",widget:"dxButton",options:{icon:"upload",text:"",onInitialized:function(e){e.element.attr("id","btnUpload")},onClick:function(){upload()}}},{location:"alter",widget:"dxSelectBox",options:{dataSource:DevExpress.data.AspNet.createStore({key:"MAHANG",loadMode:"raw",loadUrl:"wacoal_MaHang_Select_V1"}),placeholder:"Chọn Mã Hàng *",width:200,displayExpr:"MAHANG",valueExpr:"MAHANG",searchEnabled:!0,searchExpr:"MAHANG",searchMode:"contains",searchTimeout:200,minSearchLength:0,showDataBeforeSearch:!1,value:e,onInitialized:function(e){e.element.attr("id","selectBoxMH")},onValueChanged:function(n){e=n.value,GridviewMaHangLoad(e)}}})},summary:{totalItems:[{column:"COLOR_R60",summaryType:"count",customizeText:function(e){return"Total"}},{column:"SL_R60",summaryType:"sum",valueFormat:"Decimal",customizeText:function(e){return e.value}},{column:"SL_WA",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SL_WB",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SL_W300",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SL_KS60",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SL_UN420",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SL_UN280",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SL_K80",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SL_R50",summaryType:"sum",customizeText:function(e){return e.value}},{column:"SL_S80",summaryType:"sum",customizeText:function(e){return e.value}}]}}).dxDataGrid("instance")},GridviewMauNLLoaiChiNewLoad=()=>{var e="wacoal_MauNL_LoaiChi_Moi_Load_Web_V1/",n=DevExpress.data.AspNet.createStore({key:"keyMauNL_LoaiChi",loadUrl:e,onBeforeSend:function(e,n){n.xhrFields={withCredentials:!0}}});$("#GridMauNL_LoaiChi").dxDataGrid({dataSource:n,columnsAutoWidth:!0,height:555,allowColumnReordering:!0,rowAlternationEnabled:!0,showColumnLines:!0,showRowLines:!0,showBorders:!0,export:{enabled:!0},onExporting:function(e){var n=new ExcelJS.Workbook,a=n.addWorksheet("MauNL_LoaiChi_New");DevExpress.excelExporter.exportDataGrid({component:e.component,worksheet:a}).then(function(){n.xlsx.writeBuffer().then(function(e){saveAs(new Blob([e],{type:"application/octet-stream"}),"MauNL_LoaiChi_New.xlsx")})}),e.cancel=!0},focusedRowEnabled:!0,scrolling:{mode:"virtual"},columns:[{caption:"MAUNL",alignment:"center",dataField:"MAUNL"},{caption:"LOAICHI",alignment:"center",dataField:"LOAICHI"},{caption:"MAUCHI",alignment:"center",dataField:"MAUCHI"}]}).dxDataGrid("instance")},GridMHCDNewLoad=()=>{var e="CONGDOAN_MAHANG_New_Web_Load_V1",n=DevExpress.data.AspNet.createStore({key:"KeyMHM",loadUrl:e,onBeforeSend:function(e,n){n.xhrFields={withCredentials:!0}}});$("#GridMHCDNew").dxDataGrid({dataSource:n,paging:{pageSize:5},pager:{showPageSizeSelector:!0,allowedPageSizes:[10,25,50,100]},columnsAutoWidth:!0,height:555,allowColumnReordering:!0,rowAlternationEnabled:!0,showColumnLines:!0,showRowLines:!0,showBorders:!0,columnAutoWidth:!0,export:{enabled:!0},focusedRowEnabled:!0,onExporting:function(e){var n=new ExcelJS.Workbook,a=n.addWorksheet("MH_CD_New");DevExpress.excelExporter.exportDataGrid({component:e.component,worksheet:a}).then(function(){n.xlsx.writeBuffer().then(function(e){saveAs(new Blob([e],{type:"application/octet-stream"}),"MH_CD_New.xlsx")})}),e.cancel=!0},remoteOperations:!0,columns:[{caption:"MAHANG",alignment:"center",dataField:"Style"},{caption:"MAUMH",alignment:"center",dataField:"Color"}]}).dxDataGrid("instance")},loadPanel=$(".loadpanel").dxLoadPanel({shadingColor:"rgba(0,0,0,0.4)",position:{of:"#GridTinhChi"},visible:!1,showIndicator:!0,showPane:!0,shading:!1,closeOnOutsideClick:!1,onShown(){},onHidden(){GridviewMauNLLoaiChiNewLoad(),GridMHCDNewLoad()}}).dxLoadPanel("instance"),upload=()=>{loadPanel.show();let e=new FormData(document.getElementById("frmUpload")),n=$("#filename").val(),a=n.split(".").pop();if("xlsx"!=a&&"xls"!=a)return DevExpress.ui.notify({message:"Chỉ nhận excel file",width:450},"warning",5e3),void $("#filename").val("");""===n?DevExpress.ui.notify({message:"Chọn file trước khi nhập",width:450},"warning",5e3):$.ajax({type:"POST",data:e,contentType:!1,url:"/kho/congodanmahanginputv2",cache:!1,processData:!1,success:e=>{loadPanel.hide(),e.statusErr?DevExpress.ui.notify({message:e.errMes,width:450},"success",5e3):DevExpress.ui.notify({message:e.errMes,width:450},"error",5e3)}})},loadTooltip=(e,n)=>{$(`#${e}`).dxTooltip({target:`#${n}`,showEvent:"mouseenter",hideEvent:"mouseleave",closeOnOutsideClick:!1})};$(function(){MaHang="None",searchBoxMaHang(),GridviewMaHangLoad(MaHang),GridviewMauNLLoaiChiNewLoad(),GridMHCDNewLoad(),loadTooltip("tooltipUpload","btnUpload"),$("#btnSearchId").click(e=>{e.preventDefault(),MaHang=$("#searchBoxMH").dxSelectBox("instance").option("value"),GridviewMaHangLoad(MaHang)})});